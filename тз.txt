0) Цель проекта

Сделать бесконечный платформер-раннер (auto-runner): персонаж находится ближе к левому краю, мир едет влево, игрок преодолевает препятствия и набирает дистанцию. Есть жизни (сердечки), можно подбирать хилки, есть пауза.

Главная цель защиты: показать работающий проект, удовлетворяющий формальным требованиям (качество кода, обработка ошибок, отсутствие предупреждений), и обязательным пунктам ТЗ (меню, генерация, БД).

1) Ограничения (обязательные правила разработки)

Проект собирается с -Wall -Werror без предупреждений.

Идентификаторы и комментарии только на английском, без транслита.

Строки кода ≤ 100 символов.

Никаких undefined, unsafePerformIO.

Любой ввод (файл конфига, аргументы, БД) — не падаем, а возвращаем
Either String a и печатаем понятное сообщение.

Магических чисел нет (кроме размеров/цветов для отрисовки) — всё в Constants.

2) Стек

cabal (уже есть)

gloss — окно/рендер/ввод/игровой цикл

random — генерация (seed)

aeson — JSON конфиг генератора

sqlite-simple — SQLite база (рекорды + сохранения)

3) Игровые экраны (state machine)

Минимально нужные экраны:

Main Menu

Start Game

Difficulty: Easy/Normal/Hard

Leaderboard

Load Game (слот 1..3)

Exit

Playing

собственно игра, UI поверх

Pause Overlay

Resume

Save (слот 1..3)

Quit to Menu

Game Over

показ дистанции

Save Score (в рекорды)

Back to Menu / Restart

Leaderboard Screen

топ-10 результатов из БД

Для расширенного интерфейса “+2 возможности” считаем:
(а) Leaderboard, (б) Save/Load, (в) Difficulty (даже с запасом).

4) Управление

Space — jump

A/D или ←/→ — небольшой контроль по X (не основной бег, а “подруливание”)

Esc — выход (или выход в меню на паузе — решим просто)

P — пауза (обязательно)

Кнопка паузы в правом верхнем углу — кликабельная мышью (желательно),
но чтобы не рисковать: и кнопка, и горячая клавиша P.

5) Камера и движение (как именно “мир едет влево”)

Мы используем подход runner’ов:

есть значение worldScroll :: Float, оно растёт каждый кадр:
worldScroll += runSpeed * dt

рисуем мир со смещением (-worldScroll, 0)

игрок по X почти фиксирован около левого края (playerX небольшой), но может
немного двигаться A/D.

Дистанция = worldScroll (переводим в “метры” простым коэффициентом).

6) Игрок, жизни, хилки (минимально)
Игрок

прямоугольник (на первом этапе)

параметры:

playerPosX, playerPosY

playerVelY (вертикальная скорость)

onGround :: Bool (или вычисляем коллизией)

Физика (это как раз “Шаг 1b”)

гравитация: velY += gravity * dt

прыжок: если onGround и нажали Space, то velY = jumpVel

позиция: posY += velY * dt

земля: если posY <= groundY + playerHeight/2 → ставим на землю, velY = 0.

Жизни

lives от 0 до maxLives (например 3)

UI: сердечки в левом верхнем углу

урон:

столкновение со spike → lives -= 1

чтобы не “съело все жизни за 1 кадр”, вводим invincibilityTimer
(например 0.8 сек), пока он > 0 — урон не проходит.

Хилка

объект medkit

при подборе: lives = min maxLives (lives + 1)

хилки появляются “над землёй”, чтобы нужно было подпрыгнуть.

7) Мир и объекты (минимальный набор)
Сегменты / чанки

Мир делится на чанки одинаковой ширины chunkWidth.

Каждый чанк содержит список объектов:

Platform (прямоугольник)

Gap (отсутствие платформы)

Spike (вредит)

Medkit (лечит)

На самом деле удобнее хранить платформы и “дырки” как:

базовая платформа по умолчанию

дырка = участок, где платформы нет

Но для простоты можно сделать так:

чанк содержит список platformRects

если дырка — просто не добавляем платформу на участке

Коллизии

Только AABB (прямоугольник-прямоугольник).

Игрок vs платформа: только вертикальная (для земли)

Игрок vs spike/medkit: пересечение прямоугольников

8) Генерация мира (обязательная часть)

Требование:

простая генерация — повтор шаблона

постепенное усложнение

конфигурируемость

8.1 Базовый вариант (повтор шаблона)

Есть фиксированный список чанков [A,B,C], который повторяется по кругу.
Это закрывает “минимальную генерацию”.

8.2 Усложнение

Вводим difficultyLevel как функцию дистанции, например:

difficultyLevel = floor (worldScroll / 800) (чем дальше — тем выше)

При росте difficulty:

увеличивается шанс дыр/шипов

увеличивается скорость runSpeed (не обязательно, но можно)

уменьшается длина безопасных платформ

8.3 Конфиг (JSON)

Файл config.json, проверяем при запуске.

Минимальные настройки:

chunkWidth

runSpeedEasy/Normal/Hard

список объектов с параметрами:

enabled :: Bool

minDifficulty :: Int

baseRate :: Float

rateGrowth :: Float

(опционально) yRange для medkit

Валидация:

baseRate, rateGrowth >= 0

суммы вероятностей не обязаны быть 1 (мы нормируем)

если конфиг битый → Left "Config error: ..." и выход без падения.

9) База данных (обязательная часть: 2 возможности)

Используем SQLite файл, например game.db.

9.1 Leaderboard (рекорды)

Таблица scores:

id INTEGER PRIMARY KEY

player_name TEXT

distance INTEGER (или REAL)

difficulty TEXT

created_at TEXT (ISO строка)

Операции:

insertScore

getTopScores limit

9.2 Сохранение/загрузка сессий

Таблица saves:

slot INTEGER PRIMARY KEY (1..3)

seed INTEGER

world_scroll REAL

lives INTEGER

difficulty TEXT

created_at TEXT

Ключевая идея для простоты:
мы не сохраняем весь список объектов, а сохраняем:

seed генератора

текущую дистанцию/scroll

сложность/жизни
и при загрузке перегенерируем мир детерминированно (вокруг позиции камеры).

Операции:

saveGame slot state

loadGame slot -> Either String state

Все ошибки БД → Either String, без падений.

10) UI во время игры (как ты описал)

Игровой HUD:

левый верхний угол:

сердечки (lives)

дистанция (например Distance: 1234 m)

правый верхний угол:

кнопка pause (иконка/прямоугольник ||)

при паузе:

затемнение фона

небольшое меню по центру

11) Минимальный объём “чтобы сдать на 3” (MVP)

Что точно делаем:

Playing: авто-скролл + прыжок + земля

Простейший мир: платформа + дырки + 1 тип препятствия (spike)

Поражение: упал / жизни кончились

Дистанция считается и показывается

Меню (Start, Difficulty, Leaderboard, Load, Exit)

Генерация: сначала повтор шаблона, потом поверх — рост сложности через config

БД: leaderboard + save/load 3 слота

Что можно НЕ делать, если времени мало:

анимации/спрайты

сложные платформы (движущиеся)

много бонусов

мультиплеер